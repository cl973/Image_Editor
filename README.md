# ğŸ“¸ ç…§ç‰‡å¤„ç†åŠ©æ‰‹

è¿™æ˜¯ä¸€ä¸ªåŸºäºå¾®ä¿¡å°ç¨‹åºå’Œ Python Flask åç«¯çš„å›¾åƒå¤„ç†å·¥å…·ã€‚å®ƒèƒ½å¤Ÿå®ç°ç…§ç‰‡åšæ—§ä¸ç¿»æ–°ä¸¤ç§æ•ˆæœï¼šå°†ç°ä»£é«˜æ¸…ç…§ç‰‡å¤„ç†æˆå…·æœ‰å¹´ä»£æ„Ÿçš„è€ç…§ç‰‡ï¼Œæˆ–è€…å°†æ¨¡ç³Šã€ç ´æŸçš„è€ç…§ç‰‡è¿›è¡Œå»å™ªã€ä¸Šè‰²å’Œå¢å¼ºå¤åŸã€‚

## âœ¨ ä¸»è¦åŠŸèƒ½

### 1. å›¾åƒåšæ—§ (New to Old)
é€šè¿‡ç®—æ³•æ¨¡æ‹Ÿèƒ¶ç‰‡è€åŒ–çš„ç‰©ç†è¿‡ç¨‹ï¼ŒåŒ…å«ä»¥ä¸‹æ•ˆæœï¼š
*   **æ³›é»„å¤„ç†**ï¼šåŸºäº `Lab` è‰²å½©ç©ºé—´è°ƒæ•´ï¼Œæ¨¡æ‹Ÿç…§ç‰‡çº¸å¼ éšæ—¶é—´æ°§åŒ–å˜é»„çš„æ•ˆæœï¼Œå¹¶åŒ…å«åŸºäºå¹³æ–¹åæ¯”å®šå¾‹çš„è¾¹ç¼˜è¤ªè‰²ã€‚
*   **è¤ªè‰²å¤„ç†**ï¼šé™ä½é¥±å’Œåº¦ä¸å¯¹æ¯”åº¦ï¼Œæ¨¡æ‹Ÿé¢œæ–™éšæ—¶é—´åˆ†è§£ã€‚
*   **åˆ’ç—•ç”Ÿæˆ**ï¼šéšæœºç”Ÿæˆä¸»æŠ˜ç—•ã€å¾®å°åˆ’ç—•å’Œç‹¬ç«‹åˆ’ç—•ï¼Œæ¨¡æ‹Ÿç‰©ç†æŸä¼¤ã€‚
*   **å™ªç‚¹æ¨¡æ‹Ÿ**ï¼šä½¿ç”¨Weibull distributionæ¨¡æ‹ŸçœŸå®çš„èƒ¶ç‰‡é¢—ç²’æ„Ÿå’Œæ±¡æ¸ã€‚

### 2. è€ç…§ç‰‡ç¿»æ–° (Old to New)
é‡‡ç”¨å¤šçº§æµæ°´çº¿å¤„ç†ä¿®å¤è€ç…§ç‰‡ï¼š
*   **æ™ºèƒ½å»å™ªä¸ä¿®è¡¥**ï¼šåˆ©ç”¨å½¢æ€å­¦å˜æ¢ï¼ˆé¡¶å¸½/é»‘å¸½è¿ç®—ï¼‰æ£€æµ‹å™ªå£°å’Œè£‚çº¹ï¼Œç»“åˆ `cv2.inpaint` è¿›è¡Œä¿®å¤ã€‚
*   **äººè„¸ä¿æŠ¤**ï¼šé›†æˆ `Dlib` 68ç‚¹äººè„¸ç‰¹å¾ç›‘æµ‹ï¼Œåœ¨å»é™¤åˆ’ç—•æ—¶è‡ªåŠ¨ç”Ÿæˆè’™ç‰ˆä¿æŠ¤äººè„¸åŒºåŸŸï¼Œé˜²æ­¢äº”å®˜æ¨¡ç³Šã€‚
*   **è‰²å½©å¢å¼º**ï¼šåœ¨ `HSV` ç©ºé—´å¢å¼ºé¥±å’Œåº¦ï¼ŒåŒæ—¶åŒ…å«è‚¤è‰²ä¿æŠ¤é€»è¾‘ï¼Œé¿å…äººç‰©è‚¤è‰²è¿‡çº¢ã€‚
*   **å¯¹æ¯”åº¦/äº®åº¦ä¼˜åŒ–**ï¼šä½¿ç”¨è‡ªé€‚åº”ç›´æ–¹å›¾å‡è¡¡åŒ– (CLAHE) å’Œ Gamma æ ¡æ­£æå‡å›¾åƒæ¸…æ™°åº¦ã€‚
*   *(å®éªŒæ€§åŠŸèƒ½)*ï¼šä»£ç ä¸­åŒ…å« GFPGAN æ¥å£ï¼Œå¯æ‰©å±•æ·±åº¦å­¦ä¹ äººè„¸è¶…åˆ†é‡å»ºã€‚

### 3. å¾®ä¿¡å°ç¨‹åºå®¢æˆ·ç«¯
*   **å›¾ç‰‡è£å‰ª**ï¼šæ”¯æŒä¸Šä¼ å¹¶è£å‰ªå›¾ç‰‡ã€‚
*   **è½®æ’­å±•ç¤º**ï¼šé¦–é¡µåŠ¨æ€å±•ç¤ºæ•ˆæœã€‚
*   **å®æ—¶å¤„ç†**ï¼šä¸åç«¯ API å®æ—¶äº¤äº’ï¼Œä¸Šä¼ å›¾ç‰‡å¹¶è·å–å¤„ç†ç»“æœã€‚

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### Frontend (å¾®ä¿¡å°ç¨‹åº)
*   **æ¡†æ¶**ï¼šåŸç”Ÿå¾®ä¿¡å°ç¨‹åº
*   **UI ç»„ä»¶åº“**ï¼š[Vant Weapp](https://vant-contrib.gitee.io/vant-weapp)
*   **ä¸»è¦ä¾èµ–**ï¼š`@vant/weapp`

### Backend (æœåŠ¡ç«¯)
*   **è¯­è¨€**ï¼šPython 3.x
*   **Web æ¡†æ¶**ï¼šFlask
*   **æ ¸å¿ƒåº“**ï¼š
    *   `OpenCV` (`cv2`): å›¾åƒå¤„ç†æ ¸å¿ƒç®—æ³•
    *   `Numpy`: çŸ©é˜µè¿ç®—
    *   `Dlib`: äººè„¸ç‰¹å¾ç‚¹æ£€æµ‹ (ç”¨äºä¿®å¤æ—¶çš„äººè„¸ä¿æŠ¤)
    *   *(Optional)* `Torch` & `GFPGAN`: ç”¨äºæ·±åº¦å­¦ä¹ äººè„¸ä¿®å¤

---

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
Project/
â”œâ”€â”€ frontend/                 # å¾®ä¿¡å°ç¨‹åºç«¯
â”‚   â”œâ”€â”€ pages/                # é¡µé¢é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ index/            # æˆæƒ/ç™»å½•é¡µ
â”‚   â”‚   â”œâ”€â”€ home/             # ä¸»é¡µ (è½®æ’­å›¾, é€‰å›¾, è£å‰ª)
â”‚   â”‚   â”œâ”€â”€ editor1/          # å›¾åƒå¤„ç†æ§åˆ¶é¡µ (è°ƒç”¨API)
â”‚   â”‚   â”œâ”€â”€ showpic/          # ç»“æœå±•ç¤ºé¡µ
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ utils/                # å·¥å…·ç±»
â”‚   â”œâ”€â”€ app.json              # å…¨å±€é…ç½®
â”‚   â””â”€â”€ project.config.json
â”‚
â””â”€â”€ backend/                  # Python æœåŠ¡ç«¯
    â”œâ”€â”€ app.py                # Flask å…¥å£æ–‡ä»¶ & è·¯ç”±é…ç½®
    â”œâ”€â”€ processing/           # å›¾åƒå¤„ç†æ ¸å¿ƒç®—æ³•åº“
    â”‚   â”œâ”€â”€ new2old.py            # åšæ—§é€»è¾‘ (æ³›é»„, è¤ªè‰², åˆ’ç—•)
    â”‚   â”œâ”€â”€ old2new.py            # ç¿»æ–°å…¥å£
    â”‚   â”œâ”€â”€ noise_process.py      # å»å™ªä¸è£‚çº¹ä¿®å¤
    â”‚   â”œâ”€â”€ color_processing.py   # è‰²å½©å¢å¼º
    â”‚   â”œâ”€â”€ contrast_processing.py# å¯¹æ¯”åº¦å¢å¼º
    â”‚   â”œâ”€â”€ brightness_processing.py # äº®åº¦è°ƒæ•´
    â”‚   â””â”€â”€ face_processing.py    # GFPGAN (å¯é€‰)
    â”œâ”€â”€ models/               # æ¨¡å‹æ–‡ä»¶
    â”‚   â””â”€â”€ shape_predictor_68_face_landmarks.dat # Dlibæ¨¡å‹
    â”œâ”€â”€ uploads/              # ä¸´æ—¶æ¥æ”¶ä¸Šä¼ çš„å›¾ç‰‡
    â””â”€â”€ processed_image/      # å­˜æ”¾å¤„ç†å®Œæˆçš„å›¾ç‰‡
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åç«¯éƒ¨ç½² (Backend)

**ç¯å¢ƒè¦æ±‚**ï¼šPython 3.8+
éœ€è¦å®‰è£… `CMake` (ç”¨äºç¼–è¯‘ Dlib)ã€‚

1.  **å®‰è£…ä¾èµ–åº“**ï¼š
    ```bash
    pip install flask opencv-python numpy dlib imutils
    # å¦‚æœéœ€è¦å¯ç”¨ GFPGANï¼Œè¿˜éœ€å®‰è£… torch ç­‰æ·±åº¦å­¦ä¹ ä¾èµ–
    ```

2.  **å‡†å¤‡æ¨¡å‹æ–‡ä»¶**ï¼š
    ç¡®ä¿ `Backend/processing/models/` ç›®å½•ä¸‹å­˜åœ¨ `shape_predictor_68_face_landmarks.dat` æ–‡ä»¶ã€‚
    > ä¸‹è½½åœ°å€ï¼š[Dlib Model Download](http://dlib.net/files/shape_predictor_68_face_landmarks.dat.bz2) (è§£å‹åæ”¾å…¥)

3.  **å¯åŠ¨æœåŠ¡**ï¼š
    ```bash
    cd Backend
    python app.py
    ```
    æœåŠ¡é»˜è®¤è¿è¡Œåœ¨ `http://0.0.0.0:8000`ã€‚

### 2. å‰ç«¯é…ç½® (Frontend)

1.  ä½¿ç”¨ **å¾®ä¿¡å¼€å‘è€…å·¥å…·** å¯¼å…¥å°ç¨‹åºé¡¹ç›®ç›®å½•ã€‚
2.  **æ„å»º NPM**ï¼š
    åœ¨å¼€å‘è€…å·¥å…·ä¸­ï¼Œç‚¹å‡»èœå•æ  `å·¥å…·` -> `æ„å»º npm`ï¼Œç¡®ä¿ Vant Weapp ç»„ä»¶æ­£ç¡®å®‰è£…ã€‚
3.  **é…ç½®æœåŠ¡å™¨åœ°å€**ï¼š
    æ‰“å¼€ `pages/editor1/editor1.js` ï¼Œæ‰¾åˆ° `wx.uploadFile` éƒ¨åˆ†ï¼Œå°† `url` ä¿®æ”¹ä¸ºä½ åç«¯çš„å®é™… IP åœ°å€ã€‚
    ```javascript
    url: "http://ä½ çš„æœåŠ¡å™¨IP:8000/image-process"
    ```
4.  **ç¼–è¯‘è¿è¡Œ**ã€‚

## ğŸ”Œ API æ¥å£è¯´æ˜

### å›¾åƒå¤„ç†æ¥å£
*   **URL**: `/image-process`
*   **Method**: `POST`
*   **Content-Type**: `multipart/form-data`

**è¿”å›ç¤ºä¾‹**:
```json
{
  "success": true,
  "image_url": "http://1.15.143.65:8000/processed_image/uuid.jpg"
}
```
